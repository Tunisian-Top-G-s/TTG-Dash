{% extends "base.html" %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static "styles/checkout.css" %}">
{% block title %}
  <title>Checkout - Tunisian Top Gs</title>
{% endblock title%}

{% endblock head %}

{% block header %}
{% include "components/navbar.html" %}
{% endblock header %}

{% block main %}
      <div class="shopping-cart">
        <div class="h1-text">Checkout</div>
        <div class="items-container">
          <div class="Title">
            Add Your Adresse
          </div>
          <form>
            <div>
              <div class="input-container">
                <label for="name">First Name</label>
                <input type="text" id="name" name="name" />
              </div>
              <div class="input-container">
                <label for="name">Last Name</label>
                <input type="text" id="name" name="name" />
              </div>
            </div>
            <div class="input-container">
              <label for="name">Address</label>
              <input type="text" id="name" name="name" />
            </div>
            <div>
              <div class="input-container">
                <label for="name">City</label>
                <input type="text" id="name" name="name" />
              </div>
              <div class="input-container">
                <label for="name">State</label>
                <input type="text" id="name" name="name" />
              </div>
              <div class="input-container">
                <label for="name">Zip Code</label>
                <input type="text" id="name" name="name" />
              </div>
            </div>

          </form>
        </div>

        
        <div class="delivery-container">
            <div class="Title">
              Choose Your Payment Method
            </div>
            <div class="payment-method">
              <div class="payment">
                <input type="radio" id="paypal" name="payment" value="paypal" />
                <label for="paypal">Cash On Delivery </label>
                <i data-lucide="truck"></i>
              </div>
        </div>
      </div>
      </div>

      <div class="order">
        <div class="order-container">
          <div class="order-details">
            <span class="h1-text">Order Summary</span>
            <div class="price">
              <span class="p-text">Price</span>
              <span class="p-text">$319.98</span>
            </div>
            <div class="discount">
              <span class="p-text">Discount</span>
              <span class="p-text">$31.9</span>
            </div>
            <div class="shipping">
              <span class="p-text">Shipping</span>
              <span class="p-text greener">Free</span>
            </div>
            <div class="coupon">
              <span class="p-text">Coupon Applied</span>
              <span class="p-text">$0.00</span>
            </div>
          </div>
          <div class="divisier"></div>
          <div class="order-total">
            <div class="total">
              <span class="p-text">Total</span>
              <span class="p-text">$288.08</span>
            </div>
            <div class="delivery">
              <span class="p-text">Estimated Delivery by</span>
              <span class="p-text">01 Feb, 2024</span>
            </div>
            <a class="btn" href="#">Place Order</a>
            <span class="place-order">By placing your order, you agree to our company Privacy policy and Conditions of use.</span>
          </div>
        </div>
      </div>
    </main>


{% endblock main %}

{% block scripts%}
<script>
    document.addEventListener('DOMContentLoaded', function() {
      // Function to calculate the total price of items in cart
      function calculateTotal(cart) {
        let total = 0;
        cart.forEach(function(item) {
          // Assuming the price is stored as a string with "DT" suffix
          const itemPrice = parseFloat(item.price.replace('DT', ''));
          total += itemPrice * item.quantity;
        });
        return total;
      }
  
      // Function to update the order summary based on cart items
      function updateOrderSummary() {
        // Get the cart items from localStorage
        let cart = localStorage.getItem('cart');
        if (!cart) {
          cart = [];
        } else {
          cart = JSON.parse(cart);
        }
  
        // Get elements from the order summary
        const priceElement = document.querySelector('.price span:last-child');
        const discountElement = document.querySelector('.discount span:last-child');
        const couponElement = document.querySelector('.coupon span:last-child');
        const totalElement = document.querySelector('.total span:last-child');
        const deliveryElement = document.querySelector('.delivery span:last-child');
  
        // Calculate total price of items in cart
        const totalPrice = calculateTotal(cart);
        console.log(totalPrice);
  
        // For demonstration purposes, let's assume a discount and shipping
        const shipping = 'Free';
        const coupon = 0.00;
        const discount = totalPrice * 0.1; // 10% discount
  
        // Set the price element
        priceElement.textContent = `${totalPrice.toFixed(2)}DT`;
  
        // Set the discount, shipping, and coupon elements
        discountElement.textContent = `${discount.toFixed(2)}DT`;
        couponElement.textContent = `${coupon.toFixed(2)}DT`;
  
        // Calculate the total
        const total = totalPrice - discount + coupon;
        totalElement.textContent = `${total.toFixed(2)}DT`;
  
        // Set the estimated delivery date (you can update this as needed)
        const today = new Date();
  
        // Add three days to today's date
        const deliveryDate = new Date(today);
        deliveryDate.setDate(deliveryDate.getDate() + 3);
        const formattedDeliveryDate = deliveryDate.toLocaleDateString('en-GB', {
          day: '2-digit',
          month: 'short',
          year: 'numeric'
        });
  
        if (cart.length === 0) {
          // Cart is empty, set delivery date as '∞'
          deliveryElement.textContent = '∞';
        } else {
          // Cart has items, set the formatted delivery date
          deliveryElement.textContent = formattedDeliveryDate;
        }
      }
  
      // Update order summary when the page loads
      updateOrderSummary();
  
      // Add event listener for the "Place Order" button if needed
      const placeOrderBtn = document.querySelector('.btn');
      placeOrderBtn.addEventListener('click', function(event) {
        // Here you can add logic to place the order
        // For now, let's just console log a message
        console.log('Placing order...');
      });
    });  
</script>
{% endblock scripts %}
