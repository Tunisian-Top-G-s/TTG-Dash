{% extends "base.html" %}
{% load static %}

{% block head %}
{% block title %}<title>Chat | Tunisian Top Gs</title>{% endblock title %}
<link rel="stylesheet" href="{% static "styles/serverChat.css" %}">
{% endblock head %}

{% block header %}
    {% comment %} {% include "components/navbar.html" %} {% endcomment %}
{% endblock header %}

{% block main %}
    <div class="chat-wrapper">

        <div class="mobile-toggles-btn">
            <button class="toggle-chat-room-mobile" onclick="toggleRoomsMobile()">
                <i data-lucide="align-left"></i>
            </button>
            <button class="toggle-chat-members-mobile" onclick="toggleMembersMobile()">
                <i data-lucide="users"></i>
            </button>
        </div>

        <div class="chat-rooms">
            <div class="chat-rooms-header">
              
                <div class="to-courses">
                    <span>

                        <svg xmlns="http://www.w3.org/2000/svg" width="33" height="32" viewBox="0 0 33 32" fill="none">
                            <path
                                d="M4.1 22.5C3.1 20.5 2.5 18.3 2.5 16C2.5 8.3 8.8 2 16.5 2V4C9.9 4 4.5 9.4 4.5 16C4.5 18 5 19.8 5.9 21.5L4.1 22.5ZM28.5 16C28.5 22.6 23.1 28 16.5 28C13.6 28 10.9 27 8.8 25.2L14.5 19.5L13.1 18L6.6 24.5C6.2 24.9 6.2 25.5 6.6 25.9C9.2 28.5 12.8 30 16.5 30C24.2 30 30.5 23.7 30.5 16H28.5Z"
                                fill="#F5F5F5" />
                            <path
                                d="M18.5003 25C18.4003 25 18.2003 25 18.1003 24.9C17.8003 24.8 17.5003 24.5 17.5003 24.1L16.8003 19.1L18.8003 18.8L19.2003 22.1L21.4003 20.4V15C21.4003 14.7 21.5003 14.5 21.7003 14.3L24.9003 11.1C25.8003 10.2 26.4003 8.9 26.4003 7.6V6H24.9003C23.6003 6 22.3003 6.5 21.4003 7.5L18.2003 10.7C18.0003 10.9 17.8003 11 17.5003 11H12.0003L10.3003 13.2L13.6003 13.6L13.3003 15.6L8.30026 14.9C7.90026 14.9 7.60026 14.6 7.50026 14.3C7.40026 14 7.40026 13.6 7.60026 13.3L10.6003 9.3C10.9003 9.1 11.2003 9 11.5003 9H17.1003L20.1003 6C21.4003 4.7 23.2003 4 25.0003 4H26.5003C27.6003 4 28.5003 4.9 28.5003 6V7.5C28.5003 9.4 27.8003 11.1 26.5003 12.4L23.5003 15.4V21C23.5003 21.3 23.4003 21.6 23.1003 21.8L19.1003 24.8C18.9003 24.9 18.7003 25 18.5003 25Z"
                                fill="#F5F5F5" />
                        </svg>
                        courses
                    </span>
                </div>
            </div>
            <div class="text-channels">
                <div class="text-group">
                    <div class="text-channels-header">
                        <div>
                            <button class="toggle-button">
                                <i data-lucide="chevron-up" class="arrow"></i>
                            </button>
                            👔・𝗦𝗧𝗨𝗗𝗘𝗡𝗧 𝗦𝗘𝗖𝗧𝗜𝗢𝗡
                        </div>
                        <button class="add-channel">
                            <i data-lucide="plus"></i>
                        </button>
                    </div>
                    <ul class="channels-list">
                        <li class="channel-link">
                            <i data-lucide="hash"></i> 💭・𝗦𝘁𝘂𝗱𝗲𝗻𝘁-𝗖𝗵𝗮𝘁

                        </li>
                        <li class="channel-link">
                            <i data-lucide="hash"></i> 🏆・𝗖𝗿𝘆𝗽𝘁𝗼-𝘄𝗶𝗻𝘀
                        </li>
                        <li class="channel-link">
                            <i data-lucide="hash"></i> 📢・𝗦𝘁𝘂𝗱𝗲𝗻𝘁𝘀-𝗔𝗻𝗻𝗼𝘂𝗻𝗰𝗲𝗺𝗲𝗻𝘁𝘀
                        </li>
                    </ul>
                </div>
                <div class="text-group">
                    <div class="text-channels-header">
                        <div>
                            <button class="toggle-button">
                                <i data-lucide="chevron-up" class="arrow"></i>
                            </button>
                            🌌・Signals
                        </div>
                        <button class="add-channel">
                            <i data-lucide="plus"></i>
                        </button>
                    </div>
                    <ul class="channels-list">
                        <li class="channel-link active"><i data-lucide="hash"></i> 🌌・Forex Signals</li>
                        <li class="channel-link"><i data-lucide="hash"></i> 🌌・Crypto Signals</li>
                        <li class="channel-link"><i data-lucide="hash"></i> 📕・Get your Badges</li>
                    </ul>
                </div>
            </div>
            <div class="rooms-footer">
                <div class="change-status hidden">
                    <div class="status online">
                        <span class="status-online"></span>
                        <span class="status-text">Online</span>
                    </div>
                    <div class="status away">
                        <span class="status-away"></span>
                        <span class="status-text">Away</span>
                    </div>
                    <div class="status busy">
                        <span class="status-busy"></span>
                        <span class="status-text">Do Not Disturb</span>
                    </div>
                </div>
                <div class="user-profile">
                    <div class="user-container">
                        <div class="user-pic">
                            <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                            <span class="user-status"></span>
                        </div>
                        <div class="user-info">
                            <span class="user-name">John Doe</span>
                            <span class="user-status-text">Available</span>
                        </div>
                    </div>
                    <button class="change-status-btn">
                        <i data-lucide="chevron-up"></i>
                    </button>
                </div>
            </div>


        </div>
        <div class="chat-container">
            <div class="chat-header">
                <div class="chat-title">
                    <span class="chat-title-channel-group">
                        <i data-lucide="hash"></i>
                        Text Channel
                    </span>
                    <span class="chat-title-room">
                        <i data-lucide="chevron-right"></i>
                        General
                    </span>
                </div>
            </div>
            <div class="chat-box" id="chatBox">
                <div class="chat-message">
                    <div class="message-header">
                        <div class="user-pic">
                            <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                        </div>
                    </div>
                    <div class="message-content">
                        <div class="user-info">
                            <span class="user-name">Figgy</span>
                            <span class="message-date">Today</span>
                            <span class="message-time">2:30 PM</span>
                        </div>
                        <div class="message-text">
                            If you have any questions don't hesitate to reach out to a @deleted-role. They can be
                            reached at any time, Fusce porta elementum ligula hendrerit auctor. Suspendisse est ex,
                            egestas in pulvinar ut, facilisis quis velit. Vestibulum ullamcorper libero nulla, et
                            posuere odio eleifend eu. Ut feugiat lorem ac purus venenatis elementum. Mauris vestibulum
                            nibh ac turpis luctus venenatis non ut elit. Nulla venenatis, nulla quis ornare mollis, erat
                            ipsum ullamcorper ligula, sit amet blandit ipsum nisi elementum turpis. In vel blandit
                            ipsum.x
                        </div>
                        <div class="reactions-box">
                            <div class="react">
                                <div class="emoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><defs><style>.e{fill:#009345}</style></defs><rect x="1" y="1" width="22" height="22" rx="7.656" style="fill:#f8de40"/><path d="M23 13.938a14.69 14.69 0 0 1-12.406 6.531c-5.542 0-6.563-1-9.142-2.529A7.66 7.66 0 0 0 8.656 23h6.688A7.656 7.656 0 0 0 23 15.344z" style="fill:#e7c930"/><path d="M16.666 12.583H7.334a.493.493 0 0 0-.492.544c.123 1.175.875 3.842 5.158 3.842s5.035-2.667 5.158-3.842a.493.493 0 0 0-.492-.544z" style="fill:#864e20"/><path d="M12 16.969a6.538 6.538 0 0 0 2.959-.6 1.979 1.979 0 0 0-1.209-.853c-1.344-.3-1.75.109-1.75.109s-.406-.406-1.75-.109a1.979 1.979 0 0 0-1.209.853 6.538 6.538 0 0 0 2.959.6z" style="fill:#f06880"/><path class="e" d="M8.82 8.767a1.18 1.18 0 0 0-.378-.414 1.946 1.946 0 0 0-.536-.253 4.37 4.37 0 0 0-.444-.1.094.094 0 0 1-.079-.09V6.692a.1.1 0 0 1 .036-.074.081.081 0 0 1 .069-.018.882.882 0 0 1 .375.173.579.579 0 0 1 .189.385.344.344 0 0 0 .337.3H8.5a.342.342 0 0 0 .256-.116.336.336 0 0 0 .084-.262 1.536 1.536 0 0 0-.1-.407 1.22 1.22 0 0 0-.34-.465 1.457 1.457 0 0 0-.5-.273 2.3 2.3 0 0 0-.44-.092.09.09 0 0 1-.077-.089v-.246a.341.341 0 0 0-.682 0v.248a.094.094 0 0 1-.086.091 1.848 1.848 0 0 0-.975.381 1.251 1.251 0 0 0-.415 1.024 1.365 1.365 0 0 0 .146.624 1.185 1.185 0 0 0 .364.409 1.711 1.711 0 0 0 .506.238c.123.036.253.069.385.1a.091.091 0 0 1 .075.088v1.233a.092.092 0 0 1-.034.072.088.088 0 0 1-.073.019 1.089 1.089 0 0 1-.45-.189.575.575 0 0 1-.209-.39.339.339 0 0 0-.335-.293h-.118a.342.342 0 0 0-.34.383 1.254 1.254 0 0 0 .426.853 1.934 1.934 0 0 0 1.056.385.092.092 0 0 1 .077.093v.234a.341.341 0 0 0 .682 0v-.246a.094.094 0 0 1 .088-.091 2.069 2.069 0 0 0 1.02-.358 1.208 1.208 0 0 0 .467-1.03 1.29 1.29 0 0 0-.138-.619zm-.659.611a.663.663 0 0 1-.064.306.515.515 0 0 1-.175.2.941.941 0 0 1-.287.125c-.048.013-.1.023-.148.032a.084.084 0 0 1-.07-.019.1.1 0 0 1-.034-.072V8.855a.091.091 0 0 1 .034-.07.093.093 0 0 1 .059-.021h.02l.125.028a1.062 1.062 0 0 1 .295.116.512.512 0 0 1 .181.18.577.577 0 0 1 .064.29zM6.7 6.686v1.192a2.469 2.469 0 0 1-.192-.044.9.9 0 0 1-.259-.115.479.479 0 0 1-.162-.178.651.651 0 0 1-.058-.3.556.556 0 0 1 .2-.49 1.026 1.026 0 0 1 .363-.151h.02a.087.087 0 0 1 .053.019.1.1 0 0 1 .035.067zM18.723 8.767a1.18 1.18 0 0 0-.378-.414 1.946 1.946 0 0 0-.536-.249A4.37 4.37 0 0 0 17.365 8a.093.093 0 0 1-.078-.09V6.692a.093.093 0 0 1 .036-.074.078.078 0 0 1 .068-.017.892.892 0 0 1 .376.173.582.582 0 0 1 .188.385.345.345 0 0 0 .337.3h.108a.342.342 0 0 0 .256-.116.335.335 0 0 0 .084-.262 1.536 1.536 0 0 0-.1-.407 1.22 1.22 0 0 0-.332-.463 1.457 1.457 0 0 0-.5-.273 2.3 2.3 0 0 0-.44-.092.089.089 0 0 1-.076-.089v-.249a.342.342 0 0 0-.683 0v.248a.094.094 0 0 1-.086.091 1.848 1.848 0 0 0-.975.381 1.253 1.253 0 0 0-.415 1.024 1.368 1.368 0 0 0 .146.624 1.185 1.185 0 0 0 .364.409 1.711 1.711 0 0 0 .506.238c.123.036.253.069.385.1a.091.091 0 0 1 .075.088v1.233a.092.092 0 0 1-.034.072.088.088 0 0 1-.073.019 1.089 1.089 0 0 1-.45-.189.579.579 0 0 1-.209-.39.338.338 0 0 0-.336-.293h-.117a.342.342 0 0 0-.34.383 1.258 1.258 0 0 0 .426.853 1.934 1.934 0 0 0 1.056.385.092.092 0 0 1 .077.093v.234a.342.342 0 0 0 .683 0v-.246a.093.093 0 0 1 .087-.091 2.066 2.066 0 0 0 1.02-.358 1.208 1.208 0 0 0 .467-1.03 1.29 1.29 0 0 0-.143-.619zm-.659.611a.663.663 0 0 1-.064.306.515.515 0 0 1-.175.2.93.93 0 0 1-.287.125c-.048.012-.1.023-.147.032a.086.086 0 0 1-.071-.019.094.094 0 0 1-.033-.072V8.855a.091.091 0 0 1 .033-.07.093.093 0 0 1 .059-.021h.02l.125.028a1.05 1.05 0 0 1 .295.116.5.5 0 0 1 .181.182.566.566 0 0 1 .064.288zM16.6 6.686v1.192a2.469 2.469 0 0 1-.192-.044.89.89 0 0 1-.258-.115.463.463 0 0 1-.162-.178.637.637 0 0 1-.059-.3.559.559 0 0 1 .2-.49A1.026 1.026 0 0 1 16.5 6.6h.02a.087.087 0 0 1 .053.019.1.1 0 0 1 .027.067z"/></svg></div>
                                <div class="count">5</div>
                            </div>
                        </div>
                    </div>
                    <div class="reply-react">
                        <button class="reply" onclick="sendReplyMessage()">
                            <i data-lucide="reply"></i>
                        </button>
                        <div class="react">
                            <i data-lucide="smile"></i>
                        </div>
                    </div>
                </div>
                <div class="reply-message">
                    <div class="message-replied">
                        <svg xmlns="http://www.w3.org/2000/svg" width="46" height="16" viewBox="0 0 46 16" fill="none">
                            <path d="M1 15V15C1 7.26801 7.26801 1 15 1H45" stroke="#ADABAB" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                        <div class="user-pic">
                            <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                        </div>
                        <div class="user-tag">
                            @Figgy
                        </div>
                        <span>
                            If you have any questions
                        </span>
                    </div>
                    <div class="chat-message">
                        <div class="message-header">
                            <div class="user-pic">
                                <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                            </div>
                        </div>
                        <div class="message-content">
                            <div class="user-info">
                                <span class="user-name">Figgy</span>
                                <span class="message-date">Today</span>
                                <span class="message-time">2:30 PM</span>
                            </div>
                            <span>
                                If you have any questions don't hesitate to reach out to a @deleted-role. They can be
                                reached at any time, Fusce porta elementum ligula hendrerit auctor. Suspendisse est ex,
                                egestas in pulvinar ut, facilisis quis velit. Vestibulum ullamcorper libero nulla, et
                                posuere odio eleifend eu. Ut feugiat lorem ac purus venenatis elementum. Mauris vestibulum
                                nibh ac turpis luctus venenatis non ut elit. Nulla venenatis, nulla quis ornare mollis, erat
                                ipsum ullamcorper ligula, sit amet blandit ipsum nisi elementum turpis. In vel blandit
                                ipsum.x
                            </span>
                        </div>
                        <div class="reply-react">
                            <button class="reply" onclick="replyToMessage()">
                                <i data-lucide="reply"></i>
                            </button>
                            <div class="react">
                                <i data-lucide="smile"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="chat-footer-box">
                <div class="replying-to" style="display: none;">
                    <span>Replying to:</span>
                    <div class="message-replied"></div>
                    <button class="close" onclick="closeReplyMessage()">
                        <i data-lucide="x-circle"></i>
                    </button>
                </div>
                <div class="chat-input">
                    <!-- Existing elements -->
                    <i data-lucide="paperclip" onclick="document.getElementById('imageUpload').click();" style="cursor:pointer;"></i>
                    <input type="text" id="userInput" placeholder="Type your message here...">
                    
                    <!-- Hidden file input for images -->
                    <input type="file" id="imageUpload" accept="image/*" style="display:none;" onchange="previewImage(event)">
                    
                    <div class="buttons-group">
                        <!-- Existing buttons -->
                        <button class="emoji-button" onclick="toggleEmojiPicker()">
                            <i data-lucide="smile"></i>
                        </button>
                        <button class="send-message" onclick="send()">
                            <i data-lucide="send"></i>
                        </button>
                    </div>
                    <!-- Existing emoji picker -->
                    <div class="emoji-picker" id="emojiPicker"></div>
                </div>
                
            </div>
            
            
        </div>
        <div class="chat-members">
            <div class="chat-members-header">
                <i data-lucide="x" class="close-toggle"></i>
                <div>
                    <i data-lucide="users"></i>
                    MEMBERS
                </div>
                <span class="Members-counter">1,300 online members</span>
            </div>
            <div class="chat-members-body">
                <div class="SearchMember-input">
                    <input type="text" id="userInput" placeholder="Type your message here...">
                    <button class="send-message" onclick="send()">
                        <i data-lucide="send"></i>
                    </button>
                </div>
                <div class="memebers-list">
                    <div class="members-titel">
                        <img src="{% static "assets/caht.png" %}" alt="Members Badge">
                        <span>Member - <span class="counter">1</span></span>
                    </div>
                    <ul class="users-list">
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                    </ul>
                    <div class="members-titel">
                        <img src="{% static "assets/caht.png" %}" alt="Members Badge">
                        <span>Member - <span class="counter">1</span></span>
                    </div>
                    <ul class="users-list">
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                    </ul>
                    <div class="members-titel">
                        <img src="{% static "assets/caht.png" %}" alt="Members Badge">
                        <span>Member - <span class="counter">1</span></span>
                    </div>
                    <ul class="users-list">
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                    </ul>
                    <div class="members-titel">
                        <img src="{% static "assets/caht.png" %}" alt="Members Badge">
                        <span>Member - <span class="counter">1</span></span>
                    </div>
                    <ul class="users-list">
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

    </div>

{% endblock main %}

{% block footer %}{% endblock footer %}

{% block scripts %}


<script src="{% static 'js/serverChat.js' %}"></script>
<script>
    // SVGS
    const SmileSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="smile" class="lucide lucide-smile"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" x2="9.01" y1="9" y2="9"></line><line x1="15" x2="15.01" y1="9" y2="9"></line></svg>`;
    const ReplySvg = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="reply" class="lucide lucide-reply"><polyline points="9 17 4 12 9 7"></polyline><path d="M20 18v-2a4 4 0 0 0-4-4H4"></path></svg>`;
    let currentReplyMessage = null;
    document.addEventListener("DOMContentLoaded", function() {
        // Select all toggle buttons
        const toggleButtons = document.querySelectorAll('.toggle-button');
    
        // Add click event listener to each toggle button
        toggleButtons.forEach(function(toggleButton) {
            toggleButton.addEventListener('click', function() {
                const parentGroup = toggleButton.closest('.text-group');
                const channelsList = parentGroup.querySelector('.channels-list');
                const toggleButtonIcon = toggleButton.querySelector('svg');
    
                // Toggle channels visibility
                channelsList.classList.toggle('hidden');
                if (channelsList.classList.contains('hidden')) {
                    toggleButtonIcon.innerHTML = `<path d="m6 9 6 6 6-6"></path>`;
                } else {
                    toggleButtonIcon.innerHTML = `<path d="m6 15 6-6 6 6"></path>`;
                }
            });
    
            // Find the add-channel button relative to the parent text-group
            const parentGroup = toggleButton.closest('.text-group');
            const addChannelButton = parentGroup.querySelector('.add-channel');
            addChannelButton.addEventListener('click', function() {
                const channelsList = parentGroup.querySelector('.channels-list');
                const newChannelName = prompt('Enter new channel name:');
                if (newChannelName) {
                    addChannel(newChannelName, channelsList);
                }
            });
        });
    
        // Function to add a new channel to the list
        function addChannel(channelName, channelsList) {
            const newChannel = document.createElement('li');
            newChannel.className = 'channel-link';
            newChannel.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="hash" class="lucide lucide-hash"><line x1="4" x2="20" y1="9" y2="9"></line><line x1="4" x2="20" y1="15" y2="15"></line><line x1="10" x2="8" y1="3" y2="21"></line><line x1="16" x2="14" y1="3" y2="21"></line></svg> ${channelName}`;
            channelsList.appendChild(newChannel);
        }
    });
        // --------------------------------------------------
    // --------------------------------------------------
    function send() {
        if (currentReplyMessage) {
            // If there's a message being replied to, use the reply logic
            sendReplyMessage();
        } else {
            // Logic for sending a new message
            const messageInput = document.getElementById("userInput");
            const message = messageInput.value;
            const imageInput = document.getElementById("imageUpload");
            const imageFile = imageInput.files[0];
        
            if (message.trim() === "" && !imageFile) {
                console.error("No message or image to send");
                return;
            }
        
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    createAndAppendMessage(message, e.target.result); // Assuming this function exists
                };
                reader.readAsDataURL(imageFile);
            } else {
                createAndAppendMessage(message); // Assuming this function exists
            }
        
            // Reset the form
            messageInput.value = "";
            imageInput.value = "";
            const preview = document.querySelector(".preview");
            if (preview) {
                preview.remove();
            }
        }
    }
    
    // --------------------------------------------------
    // Function to send a regular message
    function sendMessage(message) {
        // Assuming you have a way to get the image data (e.g., from a preview element)
        var imageData = document.querySelector(".preview") ? document.querySelector(".preview").src : null;
    
        // Create a new message element that can handle both text and image
        var newMessage = createMessageElementWithImage("You", message, imageData); // You need to implement this function
    
        // Append the new message to the chat box
        var chatBox = document.querySelector(".chat-box");
        chatBox.appendChild(newMessage);
    
        // Clear the input field and remove the image preview after sending
        document.getElementById("userInput").value = "";
        var imagePreview = document.querySelector(".preview");
        if (imagePreview) {
            imagePreview.parentNode.removeChild(imagePreview);
        }
    }
    // --------------------------------------------------
    // Function to send a reply message
    function replyToMessage(messageContent) {
        // Set the message you're replying to
        currentReplyMessage = messageContent;
        
        // Optionally, update the UI to show that you're replying to a specific message
        // For example, showing a "Replying to: ..." indicator somewhere in your UI
        const replyingToIndicator = document.getElementById('replyingToIndicator'); // Make sure you have this element in your HTML
        if (replyingToIndicator) {
            replyingToIndicator.textContent = `Replying to: ${currentReplyMessage}`;
            replyingToIndicator.style.display = 'block'; // Make the indicator visible
        }
    
        // Set focus to the input field to start typing your reply
        document.getElementById("userInput").focus();
    }
    // --------------------------------------------------
    // Function to close the "Replying to" section
    function closeReplyMessage() {
        var replyingToDiv = document.querySelector(".chat-footer-box .replying-to");
        replyingToDiv.style.display = "none";
    }
    // --------------------------------------------------
    function createAndAppendMessage(message, imageData = null) {
        const chatBox = document.querySelector('.chat-box');
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('chat-message');
    
        const userProfilePic = document.querySelector('.user-profile .user-pic img').src;
        const userName = document.querySelector('.user-profile .user-name').textContent;
    
        let messageContent = `
            <div class="message-header">
                <div class="user-pic"><img src="${userProfilePic}" alt="user-pic"></div>
            </div>
            <div class="message-content">
                <div class="user-info">
                    <span class="user-name">${userName}</span>
                    <span class="message-date">Today</span>
                    <span class="message-time">${new Date().toLocaleTimeString()}</span>
                </div>
                <div class="message-text">${message}</div>
                ${imageData ? `<div class="message-image"><img src="${imageData}" style="max-width: 400px;"></div>` : ""}
            </div>
        `;
    
        // Create reply-react container
        const replyReactContainer = document.createElement('div');
        replyReactContainer.classList.add('reply-react');
    
        // Create the reply button
        const replyButton = document.createElement('button');
        replyButton.classList.add('reply');
        replyButton.innerHTML = ReplySvg;
        replyButton.addEventListener('click', () => replyToMessage(message));
    
        // Create the react div
        const reactDiv = document.createElement('div');
        reactDiv.classList.add('react');
        reactDiv.innerHTML = SmileSvg;
        reactDiv.addEventListener('click', toggleEmojiPicker);
    
        // Append the reply button and react div to the container
        replyReactContainer.appendChild(replyButton);
        replyReactContainer.appendChild(reactDiv);
    
        // Append the message content and reply-react container to the message div
        messageDiv.innerHTML = messageContent;
        messageDiv.appendChild(replyReactContainer);
    
        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight; // Scroll to the bottom
    }
    
    // --------------------------------------------------
    function previewImage(event) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const previewContainer = document.querySelector(".chat-input");
            let previewImage = previewContainer.querySelector(".preview");
            if (!previewImage) {
                previewImage = document.createElement("img");
                previewImage.classList.add("preview");
                previewContainer.insertBefore(previewImage, previewContainer.firstChild);
            }
            previewImage.src = e.target.result;
            previewImage.style.maxWidth = "100px";
        };
        reader.readAsDataURL(event.target.files[0]);
    }
    // Placeholder for replyToMessage function
    function replyToMessage(messageContent) {
        console.log("Setting up reply to message:", messageContent);
        currentReplyMessage = messageContent; // Store the message being replied to
    
        // Update UI to reflect replying status if necessary
        // This is just an example, adjust according to your actual UI elements
        const replyingToIndicator = document.querySelector(".replying-to");
        if (replyingToIndicator) {
            replyingToIndicator.style.display = "block";
            replyingToIndicator.textContent = `Replying to: ${currentReplyMessage}`;
        }
    }
    
    // --------------Preview Image before post---------------------
    function resetInputsAndPreview() {
        // Reset inputs
        document.getElementById("userInput").value = "";
        document.getElementById("imageUpload").value = "";

        // Remove image preview if it exists
        const preview = document.querySelector(".preview");
        if (preview) {
            preview.remove();
        }
    }
    // --------------------------------------------------
    // Function to create a message element
    function createMessageElementWithImage(userName, message, imageData) {
        var newMessage = document.createElement("div");
        newMessage.classList.add("chat-message");
        
        // Message header similar to the createMessageElement function
        var messageHeader = document.createElement("div");
        messageHeader.classList.add("message-header");
        var userPic = document.createElement("div");
        userPic.classList.add("user-pic");
        userPic.innerHTML = '<img src="{% static "assets/userpic.svg" %}" alt="user-pic">';
        messageHeader.appendChild(userPic);
        
        // Message content
        var messageContent = document.createElement("div");
        messageContent.classList.add("message-content");
        var userInfo = document.createElement("div");
        userInfo.classList.add("user-info");
        userInfo.innerHTML = `<span class="user-name">${userName}</span>`;
        var messageDate = document.createElement("span");
        messageDate.classList.add("message-date");
        messageDate.innerText = "Today";
        var messageTime = document.createElement("span");
        messageTime.classList.add("message-time");
        var currentTime = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        messageTime.innerText = currentTime;
        userInfo.appendChild(messageDate);
        userInfo.appendChild(messageTime);
        messageContent.appendChild(userInfo);
        
        // Message text
        var messageText = document.createElement("div");
        messageText.classList.add("message-text");
        messageText.innerText = message;
        messageContent.appendChild(messageText);
        
        // If imageData is provided, create and append an image element
        if (imageData) {
            var messageImage = document.createElement("img");
            messageImage.src = imageData;
            messageImage.style.maxWidth = "200px"; // Set a max width for the image
            messageContent.appendChild(messageImage);
        }
        
        // Append the message header and content to the new message element
        newMessage.appendChild(messageHeader);
        newMessage.appendChild(messageContent);
        
        // You can reuse the reply and react section from your existing createMessageElement function here
        var replyReactSection = createReplyReactSection();
        newMessage.appendChild(replyReactSection);
        
        return newMessage;
    }
    // Function to toggle the emoji picker
    function toggleEmojiPicker() {
        var emojiPicker = document.getElementById("emojiPicker");
        emojiPicker.classList.toggle("show");
        fetchEmojis(); // Fetch emojis when the picker is toggled
        console.log("Toggling emoji picker");
    }
    // --------------------------------------------------
    // Adjusted sendReplyMessage function
    function sendReplyMessage(replyMessage) {
        // Make sure there's a message to reply to
        if (!currentReplyMessage || !replyMessage) {
            console.error("No message selected for reply or reply message is empty.");
            return;
        }

        console.log(`Replying with: ${replyMessage} to message: ${currentReplyMessage}`);

        // Create a new reply message element
        const newReplyMessage = document.createElement("div");
        newReplyMessage.classList.add("reply-message");
        
        // Message replied section
        const messageReplied = document.createElement("div");
        messageReplied.classList.add("message-replied");
        messageReplied.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="46" height="16" viewBox="0 0 46 16" fill="none">
            <path d="M1 15V15C1 7.26801 7.26801 1 15 1H45" stroke="#ADABAB" stroke-width="2" stroke-linecap="round" />
        </svg>
        <div class="user-pic">
            <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
        </div>
        <div class="user-tag">@Figgy</div>
        <span>${currentReplyMessage}</span>
        `;

        // Assuming createAndAppendMessage is correctly implemented to handle the construction and display of new messages
        createAndAppendMessage(replyMessage);

        // Reset currentReplyMessage after sending the reply
        currentReplyMessage = null;
        // Optionally reset the input field
        document.getElementById("userInput").value = "";
    }

    function prepareReply(message) {
        // Implementation of preparing a reply to a message
        console.log("Preparing reply to:", message);
        // Set the message as currentReplyMessage or implement your reply preparation logic
        currentReplyMessage = message;
    } 
    

    // -----------Show count of emojis------------------------
    function addReact(react, messageContent) {
        // Find the existing reactions box or create a new one
        var reactionsBox = messageContent.querySelector(".reactions-box");
        if (!reactionsBox) {
            reactionsBox = document.createElement("div");
            reactionsBox.classList.add("reactions-box");
            messageContent.appendChild(reactionsBox);
        }

        // Check if the reaction already exists
        var existingReact = reactionsBox.querySelector(`.react .emoji[data-emoji="${react}"]`);
        if (existingReact) {
            // If the reaction already exists, increase the count
            var countDiv = existingReact.parentElement.querySelector('.count');
            var currentCount = parseInt(countDiv.innerText);
            countDiv.innerText = currentCount + 1;
        } else {
            // If the reaction does not exist, create a new one
            var reactDiv = document.createElement("div");
            reactDiv.classList.add("react");
            var emojiDiv = document.createElement("div");
            emojiDiv.classList.add("emoji");
            emojiDiv.setAttribute("data-emoji", react);
            emojiDiv.innerText = react;
            var countDiv = document.createElement("div");
            countDiv.classList.add("count");
            countDiv.innerText = "1"; // Initial count is 1

            reactDiv.appendChild(emojiDiv);
            reactDiv.appendChild(countDiv);

            reactionsBox.appendChild(reactDiv);
        }
    }
    // --------------------------------------------------
    // Function to fetch emojis from the API
    function fetchEmojis() {
        var emojiPicker = document.getElementById("emojiPicker");
        emojiPicker.innerHTML = ""; // Clear previous results
    
        fetch("https://emoji-api.com/emojis?access_key=36648086e6b1d3c021726d4a3399bafaa5c2eaa3")
            .then(response => response.json())
            .then(data => {
                // Loop through the emoji data and create buttons for each emoji
                data.forEach(emoji => {
                    var emojiButton = document.createElement("button");
                    emojiButton.innerHTML = emoji.character;
                    emojiButton.classList.add("emoji");
                    emojiButton.addEventListener("click", function() {
                        insertEmoji(emoji.character);
                    });
                    emojiPicker.appendChild(emojiButton);
                });
            })
            .catch(error => console.error('Error fetching emojis:', error));
    }
    // --------------------------------------------------
    // Function to insert the selected emoji into the input field
    function insertEmoji(emoji) {
        var userInput = document.getElementById("userInput");
        var cursorPosition = userInput.selectionStart;
        var textBefore = userInput.value.substring(0, cursorPosition);
        var textAfter = userInput.value.substring(cursorPosition);
        userInput.value = textBefore + emoji + textAfter;
    
        // Move the cursor position after the inserted emoji
        userInput.selectionStart = cursorPosition + emoji.length;
        userInput.selectionEnd = cursorPosition + emoji.length;
    
        // Hide the emoji picker after inserting
        var emojiPicker = document.getElementById("emojiPicker");
        emojiPicker.classList.remove("show");
    }
    // --------------------------------------------------
    function toggleRoomsMobile() {
        var rooms = document.querySelector('.chat-rooms');
        var close = document.querySelector('.close-rooms');
        rooms.classList.toggle('show');
        //give body style overlay Y none 
    
        // IF CLOSE BUTTON IS CLICKED CLOSE ROOMS
        close.addEventListener('click', function() {
            rooms.classList.remove('show');
    
        });
    }
    // --------------------------------------------------
    function toggleMembersMobile() {
        var rooms = document.querySelector('.chat-members');
        var close = document.querySelector('.close-toggle');
        rooms.classList.toggle('show');
        // IF CLOSE BUTTON IS CLICKED CLOSE ROOMS
        close.addEventListener('click', function() {
            rooms.classList.remove('show');
        });
        
    }
    // --------------Change Status----------------
    document.addEventListener("DOMContentLoaded", function() {
        const changeStatusButtons = document.querySelectorAll('.change-status .status');
        const userProfile = document.querySelector('.user-profile');
        const changeStatusSection = document.querySelector('.change-status');
        const toggleButtonIcon = document.querySelector('.change-status-btn svg');
    
        // Toggle change-status section visibility when button is clicked
        document.querySelector('.change-status-btn').addEventListener('click', function() {
            changeStatusSection.classList.toggle('hidden');
            if (changeStatusSection.classList.contains('hidden')) {
                toggleButtonIcon.innerHTML = `<path d="m6 9 6 6 6-6"></path>`;
            } else {
                toggleButtonIcon.innerHTML = `<path d="m6 15 6-6 6 6"></path>`;
            }
        });
    
        // Add click event listener to each change status button
        changeStatusButtons.forEach(function(button) {
            button.addEventListener('click', function() {
                const status = button.classList[1]; // Get the second class which represents the status
                updateStatus(status);
                changeStatusSection.classList.add('hidden'); // Hide change-status section after selecting a status
                if (changeStatusSection.classList.contains('hidden')) {
                    toggleButtonIcon.innerHTML = `<path d="m6 9 6 6 6-6"></path>`;
                } else {
                    toggleButtonIcon.innerHTML = `<path d="m6 15 6-6 6 6"></path>`;
                }
            });
        });
    
        // Function to update user status
        function updateStatus(status) {
            const userStatus = userProfile.querySelector('.user-status-text');
            const userStatusIcon = userProfile.querySelector('.user-status');
            const statusText = userProfile.querySelector('.status-text');
            const statusIcons = userProfile.querySelectorAll('.status');
            
            // Remove 'active' class from all status icons
            statusIcons.forEach(icon => icon.classList.remove('active'));
    
            // Update user status and status text
            userStatus.textContent = status.charAt(0).toUpperCase() + status.slice(1); // Capitalize first letter
            statusText.textContent = status.charAt(0).toUpperCase() + status.slice(1);
    
            // Set background color based on status
            if (status === 'online') {
                userStatusIcon.style.backgroundColor = '#4CAF50'; // Green for Online
            } else if (status === 'away') {
                userStatusIcon.style.backgroundColor = '#FFC107'; // Yellow for Away
            } else if (status === 'busy') {
                userStatusIcon.style.backgroundColor = '#FF5722'; // Orange for Busy
            }
    
            // Add 'active' class to the clicked status icon
            userProfile.querySelector(`.status-${status}`).classList.add('active');
        }
    });
    // --------------Change Status 2-----------------------
    document.addEventListener("DOMContentLoaded", function() {
        const changeStatusButtons = document.querySelectorAll('.change-status .status');
    
        // Add click event listener to each change status button
        changeStatusButtons.forEach(function(button) {
            button.addEventListener('click', function() {
                const status = button.classList[1]; // Get the second class which represents the status
                updateStatus(status);
            });
        });
    
        // Function to update user status
        function updateStatus(status) {
            const userStatusText = document.querySelector('.user-status-text');
            const userStatus = document.querySelector('.user-status');
            
            // Update user status and status text
            userStatusText.textContent = status.charAt(0).toUpperCase() + status.slice(1); // Capitalize first letter
    
            // Remove all existing status classes
            userStatus.classList.remove('online', 'away', 'busy');
    
            // Add the appropriate status class
            userStatus.classList.add(status);
    
            // Update background color based on status
            if (status === 'online') {
                userStatus.style.backgroundColor = '#2ECC71'; // Green for Online
            } else if (status === 'away') {
                userStatus.style.backgroundColor = '#FFC107'; // Yellow for Away
            } else if (status === 'busy') {
                userStatus.style.backgroundColor = '#FF5722'; // Orange for Busy
            }
        }
    });
        // --------------------------------------------------
    // --------------Change Status 3----------------------
    document.addEventListener("DOMContentLoaded", function() {
        const changeStatusButtons = document.querySelectorAll('.change-status-btn');
        const changeStatusSection = document.querySelector('.change-status');
    
        // Add click event listener to the toggle button
        changeStatusButtons.forEach(function(button) {
            button.addEventListener('click', function() {
                changeStatusSection.classList.toggle('visible');
            });
        });
    });
</script>
{% endblock scripts %}
