{% extends "base.html" %}
{% load static %}

{% block head %}
{% block title %}<title>Chat | Tunisian Top Gs</title>{% endblock title %}
<link rel="stylesheet" href="{% static "styles/serverChat.css" %}">
{% endblock head %}

{% block header %}
    {% comment %} {% include "components/navbar.html" %} {% endcomment %}
{% endblock header %}

{% block main %}
{% include "components/navbar.html" %}
{{ room_name|json_script:"room-name" }}
{{ user_id|json_script:"user-id" }}
    <div class="chat-wrapper">

        <div class="mobile-toggles-btn">
            <button class="toggle-chat-room-mobile" onclick="toggleRoomsMobile()">
                <i data-lucide="align-left"></i>
            </button>
            <button class="toggle-chat-members-mobile" onclick="toggleMembersMobile()">
                <i data-lucide="users"></i>
            </button>
        </div>

        <div class="chat-rooms">
            <div class="chat-rooms-header">
              
                <a href="/courses" class="to-courses">
                    <span>

                        <svg xmlns="http://www.w3.org/2000/svg" width="33" height="32" viewBox="0 0 33 32" fill="none">
                            <path
                                d="M4.1 22.5C3.1 20.5 2.5 18.3 2.5 16C2.5 8.3 8.8 2 16.5 2V4C9.9 4 4.5 9.4 4.5 16C4.5 18 5 19.8 5.9 21.5L4.1 22.5ZM28.5 16C28.5 22.6 23.1 28 16.5 28C13.6 28 10.9 27 8.8 25.2L14.5 19.5L13.1 18L6.6 24.5C6.2 24.9 6.2 25.5 6.6 25.9C9.2 28.5 12.8 30 16.5 30C24.2 30 30.5 23.7 30.5 16H28.5Z"
                                fill="#F5F5F5" />
                            <path
                                d="M18.5003 25C18.4003 25 18.2003 25 18.1003 24.9C17.8003 24.8 17.5003 24.5 17.5003 24.1L16.8003 19.1L18.8003 18.8L19.2003 22.1L21.4003 20.4V15C21.4003 14.7 21.5003 14.5 21.7003 14.3L24.9003 11.1C25.8003 10.2 26.4003 8.9 26.4003 7.6V6H24.9003C23.6003 6 22.3003 6.5 21.4003 7.5L18.2003 10.7C18.0003 10.9 17.8003 11 17.5003 11H12.0003L10.3003 13.2L13.6003 13.6L13.3003 15.6L8.30026 14.9C7.90026 14.9 7.60026 14.6 7.50026 14.3C7.40026 14 7.40026 13.6 7.60026 13.3L10.6003 9.3C10.9003 9.1 11.2003 9 11.5003 9H17.1003L20.1003 6C21.4003 4.7 23.2003 4 25.0003 4H26.5003C27.6003 4 28.5003 4.9 28.5003 6V7.5C28.5003 9.4 27.8003 11.1 26.5003 12.4L23.5003 15.4V21C23.5003 21.3 23.4003 21.6 23.1003 21.8L19.1003 24.8C18.9003 24.9 18.7003 25 18.5003 25Z"
                                fill="#F5F5F5" />
                        </svg>
                        courses
                    </span>
                </a>
            </div>
            <div class="text-channels">
                <div class="text-group">
                    <div class="text-channels-header">
                        <div>
                            <button class="toggle-button">
                                <i data-lucide="chevron-up" class="arrow"></i>
                            </button>
                            👔・𝗦𝗧𝗨𝗗𝗘𝗡𝗧 𝗦𝗘𝗖𝗧𝗜𝗢𝗡
                        </div>
                        <button class="add-channel">
                            <i data-lucide="plus"></i>
                        </button>
                    </div>
                    <ul class="channels-list">
                        <li class="channel-link" data-room="students">
                            <i data-lucide="hash"></i> 💭・𝗦𝘁𝘂𝗱𝗲𝗻𝘁-𝗖𝗵𝗮𝘁

                        </li>
                        <li class="channel-link" data-room="crypto_wins">
                            <i data-lucide="hash"></i> 🏆・𝗖𝗿𝘆𝗽𝘁𝗼-𝘄𝗶𝗻𝘀
                        </li>
                        <li class="channel-link" data-room="students_anouncements">
                            <i data-lucide="hash"></i> 📢・𝗦𝘁𝘂𝗱𝗲𝗻𝘁𝘀-𝗔𝗻𝗻𝗼𝘂𝗻𝗰𝗲𝗺𝗲𝗻𝘁𝘀
                        </li>
                    </ul>
                </div>
                <div class="text-group">
                    <div class="text-channels-header">
                        <div>
                            <button class="toggle-button">
                                <i data-lucide="chevron-up" class="arrow"></i>
                            </button>
                            🌌・Signals
                        </div>
                        <button class="add-channel">
                            <i data-lucide="plus"></i>
                        </button>
                    </div>
                    <ul class="channels-list">
                        <li class="channel-link active" data-room="forex_signals">
                            <i data-lucide="hash"></i> 🌌・Forex Signals</li>
                        <li class="channel-link" data-room="crypto_signals">
                            <i data-lucide="hash"></i> 🌌・Crypto Signals</li>
                        <li class="channel-link" data-room="badges">
                            <i data-lucide="hash"></i> 📕・Get your Badges</li>
                    </ul>
                </div>
            </div>
            <div class="rooms-footer">
                <div class="change-status hidden">
                    <div class="status online">
                        <span class="status-online"></span>
                        <span class="status-text">Online</span>
                    </div>
                    <div class="status away">
                        <span class="status-away"></span>
                        <span class="status-text">Away</span>
                    </div>
                    <div class="status busy">
                        <span class="status-busy"></span>
                        <span class="status-text">Do Not Disturb</span>
                    </div>
                </div>
                <div class="user-profile">
                    <div class="user-container">
                        <div class="user-pic">
                            <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                            <span class="user-status"></span>
                        </div>
                        <div class="user-info">
                            <span class="user-name">John Doe</span>
                            <span class="user-status-text">Available</span>
                        </div>
                    </div>
                    <button class="change-status-btn">
                        <i data-lucide="chevron-up"></i>
                    </button>
                </div>
            </div>


        </div>
        <div class="chat-container">
            <div class="chat-header">
                <div class="chat-title">
                    <span class="chat-title-channel-group">
                        <i data-lucide="hash"></i>
                        Text Channel
                    </span>
                    <span class="chat-title-room">
                        <i data-lucide="chevron-right"></i>
                        General
                    </span>
                </div>
            </div>
            <div class="chat-box" id="chatBox">
{% comment %}                 <div class="chat-message">
                    <div class="message-header">
                        <div class="user-pic">
                            <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                        </div>
                    </div>
                    <div class="message-content">
                        <div class="user-info">
                            <span class="user-name">Figgy</span>
                            <span class="message-date">Today</span>
                            <span class="message-time">2:30 PM</span>
                        </div>
                        <div class="message-text">
                            If you have any questions don't hesitate to reach out to a @deleted-role. They can be
                            reached at any time, Fusce porta elementum ligula hendrerit auctor. Suspendisse est ex,
                            egestas in pulvinar ut, facilisis quis velit. Vestibulum ullamcorper libero nulla, et
                            posuere odio eleifend eu. Ut feugiat lorem ac purus venenatis elementum. Mauris vestibulum
                            nibh ac turpis luctus venenatis non ut elit. Nulla venenatis, nulla quis ornare mollis, erat
                            ipsum ullamcorper ligula, sit amet blandit ipsum nisi elementum turpis. In vel blandit
                            ipsum.x
                        </div>
                        <div class="reactions-box">
                            <div class="react">
                                <div class="emoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><defs><style>.e{fill:#009345}</style></defs><rect x="1" y="1" width="22" height="22" rx="7.656" style="fill:#f8de40"/><path d="M23 13.938a14.69 14.69 0 0 1-12.406 6.531c-5.542 0-6.563-1-9.142-2.529A7.66 7.66 0 0 0 8.656 23h6.688A7.656 7.656 0 0 0 23 15.344z" style="fill:#e7c930"/><path d="M16.666 12.583H7.334a.493.493 0 0 0-.492.544c.123 1.175.875 3.842 5.158 3.842s5.035-2.667 5.158-3.842a.493.493 0 0 0-.492-.544z" style="fill:#864e20"/><path d="M12 16.969a6.538 6.538 0 0 0 2.959-.6 1.979 1.979 0 0 0-1.209-.853c-1.344-.3-1.75.109-1.75.109s-.406-.406-1.75-.109a1.979 1.979 0 0 0-1.209.853 6.538 6.538 0 0 0 2.959.6z" style="fill:#f06880"/><path class="e" d="M8.82 8.767a1.18 1.18 0 0 0-.378-.414 1.946 1.946 0 0 0-.536-.253 4.37 4.37 0 0 0-.444-.1.094.094 0 0 1-.079-.09V6.692a.1.1 0 0 1 .036-.074.081.081 0 0 1 .069-.018.882.882 0 0 1 .375.173.579.579 0 0 1 .189.385.344.344 0 0 0 .337.3H8.5a.342.342 0 0 0 .256-.116.336.336 0 0 0 .084-.262 1.536 1.536 0 0 0-.1-.407 1.22 1.22 0 0 0-.34-.465 1.457 1.457 0 0 0-.5-.273 2.3 2.3 0 0 0-.44-.092.09.09 0 0 1-.077-.089v-.246a.341.341 0 0 0-.682 0v.248a.094.094 0 0 1-.086.091 1.848 1.848 0 0 0-.975.381 1.251 1.251 0 0 0-.415 1.024 1.365 1.365 0 0 0 .146.624 1.185 1.185 0 0 0 .364.409 1.711 1.711 0 0 0 .506.238c.123.036.253.069.385.1a.091.091 0 0 1 .075.088v1.233a.092.092 0 0 1-.034.072.088.088 0 0 1-.073.019 1.089 1.089 0 0 1-.45-.189.575.575 0 0 1-.209-.39.339.339 0 0 0-.335-.293h-.118a.342.342 0 0 0-.34.383 1.254 1.254 0 0 0 .426.853 1.934 1.934 0 0 0 1.056.385.092.092 0 0 1 .077.093v.234a.341.341 0 0 0 .682 0v-.246a.094.094 0 0 1 .088-.091 2.069 2.069 0 0 0 1.02-.358 1.208 1.208 0 0 0 .467-1.03 1.29 1.29 0 0 0-.138-.619zm-.659.611a.663.663 0 0 1-.064.306.515.515 0 0 1-.175.2.941.941 0 0 1-.287.125c-.048.013-.1.023-.148.032a.084.084 0 0 1-.07-.019.1.1 0 0 1-.034-.072V8.855a.091.091 0 0 1 .034-.07.093.093 0 0 1 .059-.021h.02l.125.028a1.062 1.062 0 0 1 .295.116.512.512 0 0 1 .181.18.577.577 0 0 1 .064.29zM6.7 6.686v1.192a2.469 2.469 0 0 1-.192-.044.9.9 0 0 1-.259-.115.479.479 0 0 1-.162-.178.651.651 0 0 1-.058-.3.556.556 0 0 1 .2-.49 1.026 1.026 0 0 1 .363-.151h.02a.087.087 0 0 1 .053.019.1.1 0 0 1 .035.067zM18.723 8.767a1.18 1.18 0 0 0-.378-.414 1.946 1.946 0 0 0-.536-.249A4.37 4.37 0 0 0 17.365 8a.093.093 0 0 1-.078-.09V6.692a.093.093 0 0 1 .036-.074.078.078 0 0 1 .068-.017.892.892 0 0 1 .376.173.582.582 0 0 1 .188.385.345.345 0 0 0 .337.3h.108a.342.342 0 0 0 .256-.116.335.335 0 0 0 .084-.262 1.536 1.536 0 0 0-.1-.407 1.22 1.22 0 0 0-.332-.463 1.457 1.457 0 0 0-.5-.273 2.3 2.3 0 0 0-.44-.092.089.089 0 0 1-.076-.089v-.249a.342.342 0 0 0-.683 0v.248a.094.094 0 0 1-.086.091 1.848 1.848 0 0 0-.975.381 1.253 1.253 0 0 0-.415 1.024 1.368 1.368 0 0 0 .146.624 1.185 1.185 0 0 0 .364.409 1.711 1.711 0 0 0 .506.238c.123.036.253.069.385.1a.091.091 0 0 1 .075.088v1.233a.092.092 0 0 1-.034.072.088.088 0 0 1-.073.019 1.089 1.089 0 0 1-.45-.189.579.579 0 0 1-.209-.39.338.338 0 0 0-.336-.293h-.117a.342.342 0 0 0-.34.383 1.258 1.258 0 0 0 .426.853 1.934 1.934 0 0 0 1.056.385.092.092 0 0 1 .077.093v.234a.342.342 0 0 0 .683 0v-.246a.093.093 0 0 1 .087-.091 2.066 2.066 0 0 0 1.02-.358 1.208 1.208 0 0 0 .467-1.03 1.29 1.29 0 0 0-.143-.619zm-.659.611a.663.663 0 0 1-.064.306.515.515 0 0 1-.175.2.93.93 0 0 1-.287.125c-.048.012-.1.023-.147.032a.086.086 0 0 1-.071-.019.094.094 0 0 1-.033-.072V8.855a.091.091 0 0 1 .033-.07.093.093 0 0 1 .059-.021h.02l.125.028a1.05 1.05 0 0 1 .295.116.5.5 0 0 1 .181.182.566.566 0 0 1 .064.288zM16.6 6.686v1.192a2.469 2.469 0 0 1-.192-.044.89.89 0 0 1-.258-.115.463.463 0 0 1-.162-.178.637.637 0 0 1-.059-.3.559.559 0 0 1 .2-.49A1.026 1.026 0 0 1 16.5 6.6h.02a.087.087 0 0 1 .053.019.1.1 0 0 1 .027.067z"/></svg></div>
                                <div class="count">5</div>
                            </div>
                        </div>
                    </div>
                    <div class="reply-react">
                        <button class="reply" onclick="sendReplyMessage()">
                            <i data-lucide="reply"></i>
                        </button>
                        <div class="react">
                            <i data-lucide="smile"></i>
                        </div>
                    </div>
                </div>
                <div class="reply-message">
                    <div class="message-replied">
                        <svg xmlns="http://www.w3.org/2000/svg" width="46" height="16" viewBox="0 0 46 16" fill="none">
                            <path d="M1 15V15C1 7.26801 7.26801 1 15 1H45" stroke="#ADABAB" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                        <div class="user-pic">
                            <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                        </div>
                        <div class="user-tag">
                            @Figgy
                        </div>
                        <span>
                            If you have any questions
                        </span>
                    </div>
                    <div class="chat-message">
                        <div class="message-header">
                            <div class="user-pic">
                                <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                            </div>
                        </div>
                        <div class="message-content">
                            <div class="user-info">
                                <span class="user-name">Figgy</span>
                                <span class="message-date">Today</span>
                                <span class="message-time">2:30 PM</span>
                            </div>
                            <span>
                                If you have any questions don't hesitate to reach out to a @deleted-role. They can be
                                reached at any time, Fusce porta elementum ligula hendrerit auctor. Suspendisse est ex,
                                egestas in pulvinar ut, facilisis quis velit. Vestibulum ullamcorper libero nulla, et
                                posuere odio eleifend eu. Ut feugiat lorem ac purus venenatis elementum. Mauris vestibulum
                                nibh ac turpis luctus venenatis non ut elit. Nulla venenatis, nulla quis ornare mollis, erat
                                ipsum ullamcorper ligula, sit amet blandit ipsum nisi elementum turpis. In vel blandit
                                ipsum.x
                            </span>
                        </div>
                        <div class="reply-react">
                            <button class="reply" onclick="replyToMessage()">
                                <i data-lucide="reply"></i>
                            </button>
                            <div class="react">
                                <i data-lucide="smile"></i>
                            </div>
                        </div>
                    </div>
                </div> {% endcomment %}
            </div>
            <div class="chat-footer-box">
                <div class="replying-to" style="display: none;">
                    <span>Replying to:</span>
                    <div class="message-replied"></div>
                    <button class="close" onclick="closeReplyMessage()">
                        <i data-lucide="x-circle"></i>
                    </button>
                </div>
                <div class="chat-input">
                    <!-- Existing elements -->
                   
                    <i data-lucide="circle-plus" onclick="document.getElementById('imageUpload').click();" style="cursor:pointer;" ></i>
                    <textarea class="chat-message-input" type="text" id="userInput" placeholder="Type your message here..."></textarea>
                    
                    <!-- Hidden file input for images -->
                    <input type="file" id="imageUpload" accept="image/*" style="display:none;" onchange="previewImage(event)">
                    
                    <div class="buttons-group">
                        <!-- Existing buttons -->
                        <button class="emoji-button" onclick="toggleEmojiPicker()">
                            <i data-lucide="laugh"></i>
                        </button>
                        <button class="chat-message-submit" class="send-message" onclick="send()">
                            <i data-lucide="send-horizontal"></i>
                        </button>
                    </div>
                    <!-- Existing emoji picker -->
                    <div class="emoji-picker" id="emojiPicker"></div>
                    
                </div>
                
            </div>
            
            
        </div>
        <div class="chat-members">
            <div class="chat-members-header">
                <i data-lucide="x" class="close-toggle"></i>
                <div>
                    <i data-lucide="users"></i>
                    MEMBERS
                </div>
                <span class="Members-counter">{{online_members.count}} online members</span>
            </div>
            <div class="chat-members-body">
                <div class="SearchMember-input">
                    <input type="text" id="userInput" placeholder="Type your message here...">
                    <button class="send-message" onclick="send()">
                        <i data-lucide="send"></i>
                    </button>
                </div>
                <div class="memebers-list">
                    {% for badge in all_badges %}
                        <div class="members-titel">
                            <img src="{{badge.icon.url}}" alt="Members Badge">
                            <span>Members - <span class="counter">{{badge.customusers.count}}</span></span>
                        </div>
                        <ul class="users-list">
                                {% for online_member in badge.customusers.all %}
                                    <li class="user">
                                        <div class="user-pic">
                                            <img src="{{online_member.pfp.url}}" alt="user-pic">
                                            <span class="user-status"></span>
                                        </div>                                
                                        <span class="user-name">{{online_member.user.username}}</span>
                                    </li>
                                {% endfor %}
                        </ul>
                    {% endfor %}

{% comment %}                     <div class="members-titel">
                        <img src="{% static "assets/caht.png" %}" alt="Members Badge">
                        <span>Member - <span class="counter">1</span></span>
                    </div>
                    <ul class="users-list">
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                    </ul>
                    <div class="members-titel">
                        <img src="{% static "assets/caht.png" %}" alt="Members Badge">
                        <span>Member - <span class="counter">1</span></span>
                    </div>
                    <ul class="users-list">
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                    </ul>
                    <div class="members-titel">
                        <img src="{% static "assets/caht.png" %}" alt="Members Badge">
                        <span>Member - <span class="counter">1</span></span>
                    </div>
                    <ul class="users-list">
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                            <li class="user">
                                <div class="user-pic">
                                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                                    <span class="user-status"></span>
                                </div>                                
                                <span class="user-name">John Doe</span>
                            </li>
                    </ul> {% endcomment %}
                </div>
            </div>
        </div>

    </div>

{% endblock main %}

{% block footer %}{% endblock footer %}

{% block scripts %}


<script src="{% static 'js/serverChat.js' %}"></script>
<script>
    // SVGS
    const SmileSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="smile" class="lucide lucide-smile"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" x2="9.01" y1="9" y2="9"></line><line x1="15" x2="15.01" y1="9" y2="9"></line></svg>`;
    const ReplySvg = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="reply" class="lucide lucide-reply"><polyline points="9 17 4 12 9 7"></polyline><path d="M20 18v-2a4 4 0 0 0-4-4H4"></path></svg>`;
    let currentReplyMessage = null;
    document.addEventListener("DOMContentLoaded", function() {
        // Select all toggle buttons
        const toggleButtons = document.querySelectorAll('.toggle-button');
    
        // Add click event listener to each toggle button
        toggleButtons.forEach(function(toggleButton) {
            toggleButton.addEventListener('click', function() {
                const parentGroup = toggleButton.closest('.text-group');
                const channelsList = parentGroup.querySelector('.channels-list');
                const toggleButtonIcon = toggleButton.querySelector('svg');
    
                // Toggle channels visibility
                channelsList.classList.toggle('hidden');
                if (channelsList.classList.contains('hidden')) {
                    toggleButtonIcon.innerHTML = `<path d="m6 9 6 6 6-6"></path>`;
                } else {
                    toggleButtonIcon.innerHTML = `<path d="m6 15 6-6 6 6"></path>`;
                }
            });
    
            // Find the add-channel button relative to the parent text-group
            const parentGroup = toggleButton.closest('.text-group');
            const addChannelButton = parentGroup.querySelector('.add-channel');
            addChannelButton.addEventListener('click', function() {
                const channelsList = parentGroup.querySelector('.channels-list');
                const newChannelName = prompt('Enter new channel name:');
                if (newChannelName) {
                    addChannel(newChannelName, channelsList);
                }
            });
        });
    
        // Function to add a new channel to the list
        function addChannel(channelName, channelsList) {
            const newChannel = document.createElement('li');
            newChannel.className = 'channel-link';
            newChannel.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="hash" class="lucide lucide-hash"><line x1="4" x2="20" y1="9" y2="9"></line><line x1="4" x2="20" y1="15" y2="15"></line><line x1="10" x2="8" y1="3" y2="21"></line><line x1="16" x2="14" y1="3" y2="21"></line></svg> ${channelName}`;
            channelsList.appendChild(newChannel);
        }
    });
        // --------------------------------------------------
    // --------------------------------------------------
    let messageIdCounter = 0; // Global counter for message IDs
    const messageReactions = {}; // Object to track reactions for each message
    function send(message) {
        const imageInput = document.getElementById("imageUpload");
        const imageFile = imageInput.files[0];
    
        if (imageFile || message) {
            // Handle sending of the message and/or image
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // If there's an image, send it with or without text
                    createAndAppendMessage(message, e.target.result);
                    // Reset the input fields
                    resetInputsAndPreview();
                };
                reader.readAsDataURL(imageFile);
            } else {
                // If there's no image but there is text, just send the text
                createAndAppendMessage(message);
                // Reset the input fields
                resetInputsAndPreview();
            }
        } else {
            console.error("No message or image to send");
        }
    }
    
    function resetInputsAndPreview() {
        // Reset the text input and image input
        document.getElementById("userInput").value = "";
        document.getElementById("imageUpload").value = "";
        // Remove the image preview if it exists
        const preview = document.querySelector(".preview");
        if (preview) {
            preview.remove();
        }
    }
    
    document.getElementById("userInput").addEventListener("keydown", function(event) {
        if (event.key === "Enter" && !event.shiftKey) {
            event.preventDefault(); // Prevent the default action to stop form submission or newline
            send(); // Call your send function
        }
        // No need for an else case to specifically handle Shift+Enter, as the textarea naturally supports it
    });
    
    
    const userInput = document.getElementById("userInput");

    userInput.addEventListener("input", function() {
        // Reset the height to a default minimum height or to 'auto' to properly reduce its size if necessary
        this.style.height = 'auto';
        // Set the height to scrollHeight to accommodate all content
        //this.style.height = (this.scrollHeight) + 'px';
    });

    
    // --------------------------------------------------
    // Function to send a regular message
    function sendMessage(message) {
        // Assuming you have a way to get the image data (e.g., from a preview element)
        var imageData = document.querySelector(".preview") ? document.querySelector(".preview").src : null;
    
        // Create a new message element that can handle both text and image
        var newMessage = createMessageElementWithImage("You", message, imageData); // You need to implement this function
    
        // Append the new message to the chat box
        var chatBox = document.querySelector(".chat-box");
        chatBox.appendChild(newMessage);
    
        // Clear the input field and remove the image preview after sending
        document.getElementById("userInput").value = "";
        var imagePreview = document.querySelector(".preview");
        if (imagePreview) {
            imagePreview.parentNode.removeChild(imagePreview);
        }
    }


    // Function to close the "Replying to" section
    function closeReplyMessage() {
        var replyingToDiv = document.querySelector(".chat-footer-box .replying-to");
        replyingToDiv.style.display = "none";
        currentReplyMessage = null;
    }


    // --------------------------------------------------
    function createAndAppendMessage(message, imageData = null) {
        const messageId = `message-${messageIdCounter++}`; // Generate a unique message ID
        messageReactions[messageId] = {};

        const chatBox = document.querySelector('.chat-box');
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('chat-message', 'fade-in');
        messageDiv.setAttribute('data-message-id', messageId);
    
        // Format message to replace newline characters with HTML line breaks
        const formattedMessage = message.replace(/\n/g, '<br>');
    
        // Check and process any URLs in the formatted message
        const processedMessage = processMessageForVideoLinks(formattedMessage);    
    
        const userProfilePic = document.querySelector('.user-profile .user-pic img').src;
        const userName = document.querySelector('.user-profile .user-name').textContent;
    
        // Construct the message structure, excluding the image part for now
        let messageContentHTML = `
            <div class="message-header">
                <div class="user-pic"><img src="${userProfilePic}" alt="user-pic"></div>
            </div>
            <div class="message-content">
                <div class="user-info">
                    <span class="user-name">${userName}</span>
                    <span class="message-date">Today</span>
                    <span class="message-time">${new Date().toLocaleTimeString()}</span>
                </div>
                <div class="message-text">${processedMessage}</div>
            </div>
        `;
    
        messageDiv.innerHTML = messageContentHTML;
        const messageContent = messageDiv.querySelector('.message-content');
        messageDiv.setAttribute('data-message-id', messageId);

        // Append the image if present
        if (imageData) {
            const imageContainer = document.createElement('div');
            imageContainer.classList.add('message-image');
            const messageImage = document.createElement('img');
            messageImage.src = imageData;
            messageImage.classList.add("chat-message-image");
            messageImage.style.cursor = 'pointer';
            messageImage.onclick = () => showImageInModal(imageData);
            imageContainer.appendChild(messageImage);
            messageContent.appendChild(imageContainer);
        }
    
        // Append the reply-react container
        const replyReactContainer = createReplyReactContainer(messageId, message);
        messageDiv.appendChild(replyReactContainer);
    
        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
    }
    
    // Function to handle reaction addition
    function addReact(emoji, messageId) {
        if (!messageReactions[messageId][emoji]) {
            messageReactions[messageId][emoji] = 1;
        } else {
            messageReactions[messageId][emoji]++;
        }
        
        console.log(`Message ${messageId} reactions:`, messageReactions[messageId]);
    }

    // Function to create a container for reactions
    function createReplyReactContainer(messageId, message) {
        const container = document.createElement('div');
        container.classList.add('reply-react');

        // Reply button
        const replyButton = document.createElement('button');
        replyButton.classList.add('reply');
        replyButton.innerHTML = ReplySvg;
        replyButton.addEventListener('click', () => {
            replyToMessage(message, messageId);
        });
        
        // React button
        const reactButton = document.createElement('div');
        reactButton.classList.add('react');
        reactButton.innerHTML = SmileSvg;
        reactButton.addEventListener('click', () => {
            const reactionsList = container.querySelector('.reactions-list');
            reactionsList.classList.toggle('show');
        });
        
        container.appendChild(replyButton);
        container.appendChild(reactButton);

        const reactionsListDiv = document.createElement('div');
        reactionsListDiv.classList.add('reactions-list');

        // List of reactions
        const reactionsList = ['😂', '😍', '👍', '👎', '😢', '😡'];
    
        reactionsList.forEach(emoji => {
            const reactSpan = document.createElement("span");
            reactSpan.innerText = emoji;
            reactSpan.addEventListener('click', () => {
                addReact(emoji, messageId);
            });
            reactionsListDiv.appendChild(reactSpan);
            container.appendChild(reactionsListDiv);
        });
        
        return container;
    }

    function showImageInModal(imageSrc) {
        let modal = document.getElementById('image-modal');
        if (!modal) {
            modal = document.createElement('div');
            modal.id = 'image-modal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; background-color:  rgb(0 0 0 / 78%); z-index: 10000; cursor: pointer;';
            modal.addEventListener('click', () => {
                modal.style.display = 'none';
            });
            document.body.appendChild(modal);
        }

        modal.innerHTML = `<img src="${imageSrc}" style="
        max-width: 50%;
        max-height: 50%;
        border-radius: 10px;
        -webkit-box-shadow: 3px 2px 30px -6px rgb(175 174 174 / 28%);
        -moz-box-shadow: 3px 2px 30px -6px rgba(0,0,0,0.75);
        box-shadow: 3px 2px 30px -6px rgb(142 133 133 / 39%);">`;
        modal.style.display = 'flex';
    }

    function processMessageForVideoLinks(message) {
        const urlRegex = /(\bhttps?:\/\/\S+)/gi;
        return message.replace(urlRegex, function(url) {
            // Simple check for YouTube URLs
            if (url.includes("youtube.com/watch?v=") || url.includes("youtu.be/")) {
                const videoId = extractYoutubeVideoID(url);
                if (videoId) {
                    return `<iframe style='border-radius:10px;' width="560" height="315" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>`;
                }
            }
            return `<a href="${url}" target="_blank">${url}</a>`;
        });
    }
    
    function extractYoutubeVideoID(url) {
        let id = '';
        url = url.replace(/(>|<)/gi, '').split(/(vi\/|v%3D|v=|\/v\/|youtu\.be\/|\/embed\/)/);
        if (url[2] !== undefined) {
            id = url[2].split(/[^0-9a-z_\-]/i);
            id = id[0];
        } else {
            id = url;
        }
        return id;
    }

    
    // --------------------------------------------------
        function previewImage(event) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewContainer = document.querySelector(".chat-input");
                let previewImage = previewContainer.querySelector(".preview");
                if (!previewImage) {
                    previewImage = document.createElement("img");
                    previewImage.classList.add("preview");
                    previewContainer.insertBefore(previewImage, previewContainer.firstChild);
                }
                previewImage.src = e.target.result;
                previewImage.style.maxWidth = "100px";
            };
            reader.readAsDataURL(event.target.files[0]);
        }
   // Updated replyToMessage function to set currentReplyMessage
        function replyToMessage(messageContent, messageId) {
            console.log("Setting up reply to message:", messageId);
            currentReplyMessage = messageContent; // Store the message being replied to

            // Update UI to reflect replying status if necessary
            // This is just an example, adjust according to your actual UI elements
            const replyingToIndicator = document.querySelector(".replying-to");
            if (replyingToIndicator) {
                replyingToIndicator.style.display = "flex";
                replyingToIndicator.innerHTML = `
                <span>Replying to:</span>
                <div class="message-replied">
                    <div class="user-pic">
                        <img src="../static/assets/userpic.svg" alt="user-pic">
                    </div>
                    <div class="user-tag">@Figgy</div>
                    <span>${currentReplyMessage}</span>
                </div>
                <button class="close" onclick="closeReplyMessage()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>`;
            }
            document.getElementById("userInput").focus();
        }

        // --------------------------------------------------
        // Adjusted sendReplyMessage function
        function sendReplyMessage(replyMessage) {
            // Make sure there's a message to reply to
            if (!currentReplyMessage || !replyMessage) {
                console.error("No message selected for reply or reply message is empty.");
                return;
            }
        
            console.log(`Replying with: ${replyMessage} to message: ${currentReplyMessage}`);
        
            // Create a new reply message element
            const newReplyMessage = document.createElement("div");
            newReplyMessage.classList.add("reply-message");
        
            // Message replied section
            const messageReplied = document.createElement("div");
            messageReplied.classList.add("message-replied");
            messageReplied.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="46" height="16" viewBox="0 0 46 16" fill="none">
                    <path d="M1 15V15C1 7.26801 7.26801 1 15 1H45" stroke="#ADABAB" stroke-width="2" stroke-linecap="round" />
                </svg>
                <div class="user-pic">
                    <img src="{% static "assets/userpic.svg" %}" alt="user-pic">
                </div>
                <div class="user-tag">@Figgy</div>
                <span>${currentReplyMessage}</span>
            `;
        
            // Append the messageReplied to the newReplyMessage
            newReplyMessage.appendChild(messageReplied);
        
            // Check if there's an image uploaded
            const imageInput = document.getElementById("imageUpload");
            const imageFile = imageInput.files[0];
        
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const imageData = e.target.result;
                    // Create and append the reply message with image
                    const replyMessageElement = createAndAppendMessage(replyMessage, imageData);
                    newReplyMessage.appendChild(replyMessageElement);
                    finishReply();
                };
                reader.readAsDataURL(imageFile);
            } else {
                // Create and append the reply message without image
                const replyMessageElement = createAndAppendMessage(replyMessage, null);
                newReplyMessage.appendChild(replyMessageElement);
                finishReply();
            }
        
            function finishReply() {
                // Get the chat box and append the new reply message
                const chatBox = document.querySelector(".chat-box");
                chatBox.appendChild(newReplyMessage);
        
                // Reset currentReplyMessage after sending the reply
                closeReplyMessage();
                currentReplyMessage = null;
        
                // Optionally reset the input field
                document.getElementById("userInput").value = "";
                imageInput.value = "";
                const preview = document.querySelector(".preview");
                if (preview) {
                    preview.remove();
                }
                // Scroll to the bottom of the chat box
            }
        }
        
    // --------------Preview Image before post---------------------
    function resetInputsAndPreview() {
        // Reset the text input and image input
        document.getElementById("userInput").value = "";
        document.getElementById("imageUpload").value = "";
        // Reset the height of the textarea
    
        // Remove the image preview if it exists
        const preview = document.querySelector(".preview");
        if (preview) {
            preview.remove();
        }
    }

    // --------------------------------------------------
    // Function to create a message element
    function createMessageElementWithImage(userName, message, imageData) {
        var newMessage = document.createElement("div");
        newMessage.classList.add("chat-message");
        
        // Message header similar to the createMessageElement function
        var messageHeader = document.createElement("div");
        messageHeader.classList.add("message-header");
        var userPic = document.createElement("div");
        userPic.classList.add("user-pic");
        userPic.innerHTML = '<img src="{% static "assets/userpic.svg" %}" alt="user-pic">';
        messageHeader.appendChild(userPic);
        
        // Message content
        var messageContent = document.createElement("div");
        messageContent.classList.add("message-content");
        var userInfo = document.createElement("div");
        userInfo.classList.add("user-info");
        userInfo.innerHTML = `<span class="user-name">${userName}</span>`;
        var messageDate = document.createElement("span");
        messageDate.classList.add("message-date");
        messageDate.innerText = "Today";
        var messageTime = document.createElement("span");
        messageTime.classList.add("message-time");
        var currentTime = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        messageTime.innerText = currentTime;
        userInfo.appendChild(messageDate);
        userInfo.appendChild(messageTime);
        messageContent.appendChild(userInfo);
        
        // Message text
        var messageText = document.createElement("div");
        messageText.classList.add("message-text");
        messageText.innerText = message;
        messageContent.appendChild(messageText);
        
        // If imageData is provided, create and append an image element
        if (imageData) {
            var messageImage = document.createElement("img");
            messageImage.src = imageData;
            messageImage.style.maxWidth = "200px"; // Set a max width for the image
            messageContent.appendChild(messageImage);
        }
        
        // Append the message header and content to the new message element
        newMessage.appendChild(messageHeader);
        newMessage.appendChild(messageContent);
        
        // You can reuse the reply and react section from your existing createMessageElement function here
        var replyReactSection = createReplyReactSection();
        newMessage.appendChild(replyReactSection);
        
        return newMessage;
    }
    // Function to toggle the emoji picker
    function toggleEmojiPicker() {
        var emojiPicker = document.getElementById("emojiPicker");
        emojiPicker.classList.toggle("show");
        fetchEmojis(); // Fetch emojis when the picker is toggled
        console.log("Toggling emoji picker");
    }
    


    // --------------------------------------------------
    // Function to fetch emojis from the API
    function fetchEmojis() {
        var emojiPicker = document.getElementById("emojiPicker");
        emojiPicker.innerHTML = ""; // Clear previous results
    
        fetch("https://emoji-api.com/emojis?access_key=36648086e6b1d3c021726d4a3399bafaa5c2eaa3")
            .then(response => response.json())
            .then(data => {
                // Loop through the emoji data and create buttons for each emoji
                data.forEach(emoji => {
                    var emojiButton = document.createElement("button");
                    emojiButton.innerHTML = emoji.character;
                    emojiButton.classList.add("emoji");
                    emojiButton.addEventListener("click", function() {
                        insertEmoji(emoji.character);
                    });
                    emojiPicker.appendChild(emojiButton);
                });
            })
            .catch(error => console.error('Error fetching emojis:', error));
    }
    // --------------------------------------------------
    // Function to insert the selected emoji into the input field
    function insertEmoji(emoji) {
        var userInput = document.getElementById("userInput");
        var cursorPosition = userInput.selectionStart;
        var textBefore = userInput.value.substring(0, cursorPosition);
        var textAfter = userInput.value.substring(cursorPosition);
        userInput.value = textBefore + emoji + textAfter;
    
        // Move the cursor position after the inserted emoji
        userInput.selectionStart = cursorPosition + emoji.length;
        userInput.selectionEnd = cursorPosition + emoji.length;
    
        // Hide the emoji picker after inserting
        var emojiPicker = document.getElementById("emojiPicker");
        emojiPicker.classList.remove("show");
    }
    // --------------------------------------------------
    function toggleRoomsMobile() {
        var rooms = document.querySelector('.chat-rooms');
        var close = document.querySelector('.close-rooms');
        rooms.classList.toggle('show');
        //give body style overlay Y none 
    
        // IF CLOSE BUTTON IS CLICKED CLOSE ROOMS
        close.addEventListener('click', function() {
            rooms.classList.remove('show');
    
        });
    }
    // --------------------------------------------------
    function toggleMembersMobile() {
        var rooms = document.querySelector('.chat-members');
        var close = document.querySelector('.close-toggle');
        rooms.classList.toggle('show');
        // IF CLOSE BUTTON IS CLICKED CLOSE ROOMS
        close.addEventListener('click', function() {
            rooms.classList.remove('show');s
        });
        
    }

    channelLinks = document.querySelectorAll(".channel-link")
    channelLinks.forEach(link => {
        link.onclick = function(e) {
            const roomName = link.getAttribute('data-room');
            window.location.pathname = '/chat/' + roomName + '/';
        };
    });

    let chatRooms = {
        students: [
            {
                id: 1,
                userName: 'Walid 1',
                message: "If you have any questions don't hesitate to reach out to a @deleted-role. They can be reached at any time, Fusce porta elementum ligula hendrerit auctor. Suspendisse est ex, egestas in pulvinar ut, facilisis quis velit. Vestibulum ullamcorper libero nulla, et posuere odio eleifend eu. Ut feugiat lorem ac purus venenatis elementum. Mauris vestibulum nibh ac turpis luctus venenatis non ut elit. Nulla venenatis, nulla quis ornare mollis, erat ipsum ullamcorper ligula, sit amet blandit ipsum nisi elementum turpis. In vel blandit ipsum.x",
                profilePicture: "assets/userpic1.svg", // {% static "assets/userpic.svg" %}Assuming assets are stored in an 'assets' directory
                messageDate: "Today",
                messageTime: "2:30 PM"
            },
            {
                id: 2,
                userName: 'Moetaz Labranzi 2',
                message: "ya dark wallahi nched manikek oou ya fares stana nahsrek fi benzert wallah fi geltet el bhayriya manched el dahdouha ou nedarcheh aleha ke dhorjiha ya faroussa mta zebi ou dark zab zab zab!",
                profilePicture: "assets/userpic2.svg",
                messageDate: "Today",
                messageTime: "3:45 PM"
            }
        ],
        crypto_wins: [
            {
                id: 1,
                userName: 'Crypto Fan',
                message: "Crypto is booming!",
                profilePicture: "assets/userpic3.svg",
                messageDate: "Yesterday",
                messageTime: "4:20 PM"
            }
        ],
        // Add other rooms with similar structure
    };
    

    document.addEventListener('DOMContentLoaded', function() {
        // Assuming your chat message container has the ID 'chatBox'
        const chatBox = document.getElementById('chatBox');
        const STATIC_URL = '/static/';
        // Function to update chat messages based on the selected room
        function updateChatMessages(messages) {
            const chatBox = document.getElementById('chatBox'); // Make sure you have a container with this ID
            chatBox.innerHTML = ''; // Clear current chat messages {% static "assets/userpic.svg" %}
        
            messages.forEach(msg => {
                const messageElement = document.createElement('div');
                messageElement.classList.add('chat-message');
                messageElement.innerHTML = `
                    <div class="message-header">
                        <div class="user-pic">
                            <img src="${STATIC_URL + msg.profilePicture}" alt="user-pic"> 
                        </div>
                    </div>
                    <div class="message-content">
                        <div class="user-info">
                            <span class="user-name">${msg.userName}</span>
                            <span class="message-date">${msg.messageDate}</span>
                            <span class="message-time">${msg.messageTime}</span>
                        </div>
                        <div class="message-text">${msg.message}</div>
                        <div class="reactions-box">
                            <div class="react">
                                <div class="emoji"><!-- SVG or Emoji --></div>
                                <div class="count">5</div> <!-- Example static reaction count -->
                            </div>
                        </div>
                    </div>
                    <div class="reply-react">
                        <button class="reply" onclick="sendReplyMessage()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-reply"><polyline points="9 17 4 12 9 7"/><path d="M20 18v-2a4 4 0 0 0-4-4H4"/></svg>
                        </button>
                        <div class="react">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-smile"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" x2="9.01" y1="9" y2="9"/><line x1="15" x2="15.01" y1="9" y2="9"/></svg>
                        </div>
                    </div>
                `;
                chatBox.appendChild(messageElement);
            });
        }
        
        
    
        // Attach click event listeners to channel links
        document.querySelectorAll('.channel-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault(); // Prevent default link action
                const roomName = this.getAttribute('data-room');
                window.location.pathname = '/server-chat/' + roomName + '/';
                //updateChatMessages(roomName);
            });
        });
    });
    
    

// Parse the JSON string back into a JavaScript object
const messages = JSON.parse('{{ messages_json|escapejs }}');
const roomName = JSON.parse(document.getElementById('room-name').textContent);
const customuser_id = {{ customuser_id }}
const chatSocket = new WebSocket(
    'ws://'
    + window.location.host
    + '/ws/chat/'
    + roomName
    + '/'
);
// Function to display old messagesmedia
function displayOldMessages(messages) {
    const chatLog = document.querySelector('#chatBox');
    chatLog.value = ''; // Clear existing messages
    if (Array.isArray(messages) && messages.length > 0) {
        messages.forEach(message => {
            console.log(message)
            console.log(`/media/${message.user__pfp}`)
            const messageElement = document.createElement('div');
            messageElement.classList.add('chat-message');
            messageElement.innerHTML = `
            <div class="message-header">
                <div class="user-pic">
                    <img src="/media/${message.user__pfp}" alt="user-pic"> 
                </div>
            </div>
            <div class="message-content">
                <div class="user-info">
                    <span class="user-name">${message.user__user__username}</span>
                    <span class="message-date">${message.timestamp}</span>
                    <span class="message-time">${message.timestamp}</span>
                </div>
                <div class="message-text">${message.content}</div>
                <div class="reactions-box">
                    <div class="react">
                        <div class="emoji"><!-- SVG or Emoji --></div>
                        <div class="count">5</div> <!-- Example static reaction count -->
                    </div>
                </div>
            </div>
            <div class="reply-react">
                <button class="reply" onclick="sendReplyMessage()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-reply"><polyline points="9 17 4 12 9 7"/><path d="M20 18v-2a4 4 0 0 0-4-4H4"/></svg>
                </button>
                <div class="react">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-smile"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" x2="9.01" y1="9" y2="9"/><line x1="15" x2="15.01" y1="9" y2="9"/></svg>
                </div>
            </div>
        `;
            chatLog.appendChild(messageElement);
        });
    } else {
        console.log('No old messages for this room.');
    }
}
// Display old messages when the page loads
displayOldMessages(messages);
chatSocket.onmessage = function(e) {
    const message = JSON.parse(e.data);
    console.log(message);
    const messageElement = document.createElement('div');
    messageElement.classList.add('chat-message');
    messageElement.innerHTML = `
    <div class="message-header">
        <div class="user-pic">
            <img src="${message.pfp}" alt="user-pic"> 
        </div>
    </div>
    <div class="message-content">
        <div class="user-info">
            <span class="user-name">${message.username}</span>
            <span class="message-date">${JSON.parse(message.instance)[0].fields.timestamp}</span>
            <span class="message-time">${JSON.parse(message.instance)[0].fields.timestamp}</span>
        </div>
        <div class="message-text">${message.message}</div>
        <div class="reactions-box">
            <div class="react">
                <div class="emoji"><!-- SVG or Emoji --></div>
                <div class="count">5</div> <!-- Example static reaction count -->
            </div>
        </div>
    </div>
    <div class="reply-react">
        <button class="reply" onclick="sendReplyMessage()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-reply"><polyline points="9 17 4 12 9 7"/><path d="M20 18v-2a4 4 0 0 0-4-4H4"/></svg>
        </button>
        <div class="react">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-smile"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" x2="9.01" y1="9" y2="9"/><line x1="15" x2="15.01" y1="9" y2="9"/></svg>
        </div>
    </div>
`;
    const chatLog = document.querySelector('#chatBox')
    chatLog.appendChild(messageElement);
};
chatSocket.onclose = function(e) {
    console.error('Chat socket closed unexpectedly');
};
document.querySelector('.chat-message-input').focus();
document.querySelector('.chat-message-input').onkeyup = function(e) {
    if (e.key === 'Enter') {  // enter, return
        document.querySelector('.chat-message-submit').click();
    }
};
document.querySelector('.chat-message-submit').onclick = function(e) {
    const messageInputDom = document.querySelector('.chat-message-input');
    const message = messageInputDom.value;
    chatSocket.send(JSON.stringify({
        'message': message,
        'customuser_id': customuser_id // Send user_id along with the message
    }));
    messageInputDom.value = '';
};


</script>
<script type="text/javascript">
    var STATIC_URL = "{% static '' %}";
</script>

{% endblock scripts %}
